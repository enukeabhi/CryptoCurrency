<!doctype>
<html>

<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>   
<script type="text/javascript" src="../dist/web3.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    var Web3 = require('web3');
    var web3 = new Web3();
    // custom token HiHi
    var custom_token_address= "0x3D6cd8b1c6B402E08881E855023aFCa03b0Bb838";
    web3.setProvider(new web3.providers.HttpProvider("http://localhost:8545"));
    var abi = [ { "constant": true, "inputs": [], "name": "mintingFinished", "outputs": [ { "name": "", "type": "bool", "value": false } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "name", "outputs": [ { "name": "", "type": "string", "value": "HiHi Token" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "endBlock", "outputs": [ { "name": "", "type": "uint256", "value": "1400000" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "_spender", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "approve", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "totalSupply", "outputs": [ { "name": "", "type": "uint256", "value": "50000000000001000000" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "_from", "type": "address" }, { "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "transferFrom", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "rate", "outputs": [ { "name": "", "type": "uint256", "value": "100" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "decimals", "outputs": [ { "name": "", "type": "uint256", "value": "18" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "weiRaised", "outputs": [ { "name": "", "type": "uint256", "value": "500000000000000000" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_amount", "type": "uint256" } ], "name": "mint", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "startBlock", "outputs": [ { "name": "", "type": "uint256", "value": "1100000" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [ { "name": "_owner", "type": "address" } ], "name": "balanceOf", "outputs": [ { "name": "balance", "type": "uint256", "value": "0" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [], "name": "finishMinting", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": true, "inputs": [], "name": "symbol", "outputs": [ { "name": "", "type": "string", "value": "HT" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "_to", "type": "address" }, { "name": "_value", "type": "uint256" } ], "name": "transfer", "outputs": [ { "name": "", "type": "bool" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "_balance", "type": "uint256" }, { "name": "_amount", "type": "uint256" } ], "name": "getCoins", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "minimumBalanceInFinney", "type": "uint256" } ], "name": "setMinBalance", "outputs": [], "payable": false, "type": "function" }, { "constant": true, "inputs": [ { "name": "_owner", "type": "address" }, { "name": "_spender", "type": "address" } ], "name": "allowance", "outputs": [ { "name": "remaining", "type": "uint256", "value": "0" } ], "payable": false, "type": "function" }, { "constant": false, "inputs": [ { "name": "beneficiary", "type": "address" } ], "name": "buyTokens", "outputs": [], "payable": true, "type": "function" }, { "constant": true, "inputs": [], "name": "hasEnded", "outputs": [ { "name": "", "type": "bool", "value": false } ], "payable": false, "type": "function" }, { "inputs": [ { "name": "_startBlock", "type": "uint256", "index": 0, "typeShort": "uint", "bits": "256", "displayName": "&thinsp;<span class=\"punctuation\">_</span>&thinsp;start Block", "template": "elements_input_uint", "value": "1100000" }, { "name": "_endBlock", "type": "uint256", "index": 1, "typeShort": "uint", "bits": "256", "displayName": "&thinsp;<span class=\"punctuation\">_</span>&thinsp;end Block", "template": "elements_input_uint", "value": "1400000" }, { "name": "_rate", "type": "uint256", "index": 2, "typeShort": "uint", "bits": "256", "displayName": "&thinsp;<span class=\"punctuation\">_</span>&thinsp;rate", "template": "elements_input_uint", "value": "100" } ], "payable": false, "type": "constructor" }, { "payable": true, "type": "fallback" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "recipient", "type": "address" } ], "name": "EthRec", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "to", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" } ], "name": "Mint", "type": "event" }, { "anonymous": false, "inputs": [], "name": "MintFinished", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "purchaser", "type": "address" }, { "indexed": true, "name": "beneficiary", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" }, { "indexed": false, "name": "amount", "type": "uint256" } ], "name": "TokenPurchase", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "recipient", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" }, { "indexed": false, "name": "balance", "type": "uint256" } ], "name": "LogSent", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "recipient", "type": "address" }, { "indexed": false, "name": "amount", "type": "uint256" }, { "indexed": false, "name": "balance", "type": "uint256" } ], "name": "LogErr", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "owner", "type": "address" }, { "indexed": true, "name": "spender", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" } ], "name": "Approval", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": true, "name": "from", "type": "address" }, { "indexed": true, "name": "to", "type": "address" }, { "indexed": false, "name": "value", "type": "uint256" } ], "name": "Transfer", "type": "event" } ];
    
    /* web3.eth.defaultAccount = "0xFf8D5CEDc604139595C2f8f6a19Ff8bd3293fb99";
    var custom_token_address= "0x3D6cd8b1c6B402E08881E855023aFCa03b0Bb838";
    web3.personal.unlockAccount("0xFf8D5CEDc604139595C2f8f6a19Ff8bd3293fb99","sandeep@55");  
    var MyContract = web3.eth.contract(abi);
    var myContractInstance = MyContract.at(custom_token_address);

    myContractInstance.transfer("0x7eeffd69aa19d1e2812449d38fef2b0b72220355","0x1"); // 1 is wei
    */


    
    
    var accounts = web3.eth.accounts;
    var contactHtml = '';
    $.each(accounts,function(i,value){
        balance = web3.eth.getBalance(value);
        contactHtml ="<tr><td>"+value+"</td><td>"+web3.eth.getTransactionCount(value)+"</td><td>"+web3.fromWei(balance.toNumber(), "ether")+"</td></tr>";
       // alert(contactHtml);
        $("#contact_list").append(contactHtml);
    })
    // send transection 
    $("#sendTransection").on("click",function(e){        
        e.preventDefault();
        
        web3.eth.defaultAccount = $("#from").val();

        web3.personal.unlockAccount($("#from").val(),$("#password").val());  
        var MyContract = web3.eth.contract(abi);
        var myContractInstance = MyContract.at(custom_token_address);
        var wei =   unit_to_wei(parseInt($("#value").val()));
        hexString = wei.toString(16);
        var transection_id = myContractInstance.transfer($("#to").val(),"0x"+hexString); 
        console.log(transection_id);
        alert("Successfuly Transfered");

    });
    // create_newaccount 
    $("#create_newaccount").on("click",function(e){        
        e.preventDefault();
        
        var new_account_password  = $("#new_account_password").val();
        var res = web3.personal.newAccount(new_account_password);
        //0x1dfc9a82e15a5319380598d6189cf0c74bffd301
        // pass : test123
        console.log(res);
 
        alert("Successfuly Created");

    });

    // balace 
    var balance_of = web3.eth.getBalance("0xFf8D5CEDc604139595C2f8f6a19Ff8bd3293fb99");
    $("#balance_of").html("value="+balance_of);

});
//http://ethdocs.org/en/latest/ether.html
function unit_to_wei(balance){
    return balance*1000000000000000000;
}


/*$.get(
    'https://rinkeby.etherscan.io/tx/0x1e94206a32a590326d9f0a867ec3c092c66fa81fc958d95b99fc56420c156f37',
    function (response) {
        console.log("> ", response);
        $("#div-ajax-field").html(response);
}); */   

</script>
</head>
<body>
    <h1>Contract List</h1>
    <table id="contact_list">
        <tr><th>Account</th><th>Total Transactions</th><th>Balance in ether</th></tr>       
    </table>
    <hr>
   
    <h3>Send Transaction Form</h3>
    <form action="#" method="post">
        <table>
            
            <tr>
                <td>From</td>
                <td><input type="text" name="from" id="from" value=""></td>
            </tr>
            <tr>
                <td>To</td>
                <td><input type="text" name="to" id="to" value=""></td>
            </tr>         
            <tr>
                <td>value(HiHi Token)</td>
                <td><input type="text" name="value" id="value" value="1"></td>
            </tr>   
            <tr>
                <td>Password</td>
                <td><input type="text" name="password" id="password" value=""></td>
            </tr>       
            <tr>
                <td></td>
                <td><input type="submit" name ="sendTransection" value="Submit" id="sendTransection"></td>
            </tr>                               
        </table>
        
    </form>
    <hr> 
    <h3>Transections List</h3>
    <table>
        <tr>
            <th>Transection Id : </th>
            <td>0x1e94206a32a590326d9f0a867ec3c092c66fa81fc958d95b99fc56420c156f37</td>
        </tr>
    </table>
    <p>https://ethereum.stackexchange.com/questions/8547/how-to-explore-all-transactions-for-a-given-account</p>
    <div id="div-ajax-field">
        

    </div>
    <hr>
   
    <h3>New Account</h3>
    <form action="#" method="post">
        <table>
            
            <tr>
                <td>Password</td>
                <td><input type="text" name="new_account_password" id="new_account_password" value=""></td>
            </tr>
                   
            <tr>
                <td></td>
                <td><input type="submit" name ="create_newaccount" value="Create" id="create_newaccount"></td>
            </tr>                               
        </table>
        
    </form>
    <table>
        <tr>
            <td>Balace of </td>
            <td id="balance_of"></td>
        </tr>
    </table>

</body>
</html>

